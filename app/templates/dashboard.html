<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dashboard - CSV → DAT Converter</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/static/dashboard.css">
  </head>

  <body>
    <div class="dashboard-container">
      <div class="dashboard-header">
        <h1>CSV → DAT</h1>
        <small>Welcome, Lazy bums!</small>
      </div>

      <div class="choices">
        <!-- VAT Relief dropdown button -->
        <div class="dropdown-container">
            <button class="choice-btn" id="vatReliefBtn">
            <i class="fa-solid fa-file-invoice-dollar me-2"></i> VAT Relief
            <i class="fa-solid fa-caret-down ms-2"></i>
            </button>
            <div id="vatSubmenu" class="submenu mt-2" style="display: none;">
            <button class="choice-btn sub-btn" id="salesBtn" style="margin-bottom: 0.3rem;">
                <i class="fa-solid fa-chart-line me-2"></i> Sales
            </button>
            <button class="choice-btn sub-btn" id="purchasesBtn">
                <i class="fa-solid fa-cart-shopping me-2"></i> Purchases
            </button>
            </div>
        </div>

        <button class="choice-btn" onclick="location.href='/sawt'">
          <i class="fa-solid fa-file-contract me-2"></i> SAWT
        </button>

        <div class="dropdown-container">
            <button class="choice-btn" id="qapBtn">
            <i class="fa-solid fa-file-invoice-dollar me-2"></i> QAP
            <i class="fa-solid fa-caret-down ms-2"></i>
            </button>
            <div id="qapSubmenu" class="submenu mt-2" style="display: none;">
            <button class="choice-btn sub-btn" id="quarterlyBtn" style="margin-bottom: 0.3rem;">
                <i class="fa-solid fa-chart-line me-2"></i> 1601EQ
            </button>
            <button class="choice-btn sub-btn" id="annualBtn">
                <i class="fa-solid fa-cart-shopping me-2"></i> 1604E
            </button>
            </div>
        </div>

        <button class="choice-btn" onclick="location.href='/compen'">
          <i class="fa-solid fa-file-contract me-2"></i> 1604C
        </button>
      </div>

      <div class="logout mt-4">
        <a href="/logout"><i class="fa-solid fa-right-from-bracket me-1"></i> Logout</a>
      </div>
    </div>

    <script>
        // Fade in on page load
        window.addEventListener("load", () => {
            document.body.classList.add("fade-in");
        });

        // Function for smooth redirect
        function smoothRedirect(url) {
            document.body.classList.remove("fade-in");
            document.body.classList.add("fade-out");
            setTimeout(() => {
                window.location.href = url;
            }, 400); // delay to match fade-out duration
        }

        // Keep track of currently open dropdown
        let currentOpenDropdown = null;

        // Function to close all dropdowns except the specified one
        function closeOtherDropdowns(exceptId = null) {
            const dropdowns = ['vatSubmenu', 'qapSubmenu'];
            
            dropdowns.forEach(dropdownId => {
                if (dropdownId !== exceptId) {
                    const dropdown = document.getElementById(dropdownId);
                    if (dropdown) {
                        dropdown.style.display = 'none';
                    }
                }
            });
        }

        // Toggle VAT Relief submenu
        document.getElementById("vatReliefBtn").addEventListener("click", () => {
            const submenu = document.getElementById("vatSubmenu");
            const isOpening = submenu.style.display === "none";
            
            // Close other dropdowns first
            closeOtherDropdowns(isOpening ? 'vatSubmenu' : null);
            
            // Toggle current dropdown
            submenu.style.display = isOpening ? "block" : "none";
            
            // Update tracking
            currentOpenDropdown = isOpening ? 'vatSubmenu' : null;
        });

        // Toggle QAP submenu
        document.getElementById("qapBtn").addEventListener("click", () => {
            const submenu = document.getElementById("qapSubmenu");
            const isOpening = submenu.style.display === "none";
            
            // Close other dropdowns first
            closeOtherDropdowns(isOpening ? 'qapSubmenu' : null);
            
            // Toggle current dropdown
            submenu.style.display = isOpening ? "block" : "none";
            
            // Update tracking
            currentOpenDropdown = isOpening ? 'qapSubmenu' : null;
        });

        // Close dropdowns when clicking outside (optional enhancement)
        document.addEventListener('click', (event) => {
            const isClickInsideDropdown = event.target.closest('.dropdown-container');
            const isClickOnDropdownButton = event.target.closest('.choice-btn[id$="Btn"]');
            
            if (!isClickInsideDropdown && !isClickOnDropdownButton) {
                closeOtherDropdowns();
                currentOpenDropdown = null;
            }
        });

        // Redirects with fade transition
        document.getElementById("purchasesBtn").addEventListener("click", () => {
            smoothRedirect("/purchases");
        });
        document.getElementById("salesBtn").addEventListener("click", () => {
            smoothRedirect("/sales");
        });

        document.getElementById("quarterlyBtn").addEventListener("click", () => {
            smoothRedirect("/qap-quarterly");
        });

        document.getElementById("annualBtn").addEventListener("click", () => {
            smoothRedirect("/qap-annual");
        });
    </script>
  </body>
</html>